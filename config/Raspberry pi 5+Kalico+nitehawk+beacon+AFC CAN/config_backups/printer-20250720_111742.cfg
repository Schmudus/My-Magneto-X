[include beacon.cfg]
[include mainsail.cfg]
[include client_variable.cfg]
[include magneto_device.cfg]
[include magneto_toolhead.cfg]
[include shell_command.cfg]
[include macros.cfg]
[include bt_macro.cfg]
#[include timelapse.cfg]
[include stepper.cfg]
#[include TMC2240.cfg]
[include TMC5160.cfg]
[include temperatures.cfg]
[include neopixel.cfg]
[include fan_tach_monitor.cfg]
[include danger_options.cfg]
#[include shaketune.cfg]
[include AFC/*.cfg]
[include test_print.cfg]
[include TEST_SPEED.cfg]
[skew_correction]
[exclude_object]
[save_variables]
filename: ~/printer_data/config/variables.cfg
  
[idle_timeout]
gcode:
    {% if printer.pause_resume.is_paused %}
        M104 S0
    {% else %}
        LM_DISABLE
        TURN_OFF_HEATERS
        M84
        M118 Idle timeout
    {% endif %}
timeout: 3600

[gcode_arcs]
resolution: 0.1

[force_move]
enable_force_move: True

#####################################################################
#	Gantry level and Mesh
#####################################################################

[quad_gantry_level]
gantry_corners:
    -96,-78.5
    353.5,437

points:
  25,25
  25,350
  283,350
  283,25

speed: 350
horizontal_move_z: 10
retries: 8
retry_tolerance: 0.02 #0.01 #0.0050
max_adjust: 8

[bed_mesh]
speed: 500
zero_reference_position: 150, 233
mesh_min: 0, -20 
mesh_max: 283,340
probe_count: 20, 20
algorithm: bicubic
bicubic_tension: 0.2
fade_start: 0.6
fade_end: 10
fade_target: 0

#####################################################################
# Heater bed
#####################################################################

[heater_bed]
heater_pin: PA1
max_power: 0.95
sensor_pin: PF3
sensor_type: Generic 3950
smooth_time: 1.0
pwm_cycle_time: 0.3
min_temp: -200
max_temp: 130
#control: pid
#pid_kp: 70.488 #63.238
#pid_ki: 0.702 #0.855
#pid_kd: 1169.116

#####################################################################
#	Extruder
#####################################################################

[extruder]
step_pin: nhk:gpio23
dir_pin: nhk:gpio24
enable_pin: !nhk:gpio25
rotation_distance: 4.637  	
microsteps: 16
full_steps_per_rotation: 200	
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: nhk:gpio9
sensor_pin: nhk:gpio29
sensor_type: magneto_adc
max_extrude_only_distance: 300.0
max_extrude_cross_section: 100.0
#adc_voltage: 3.3
pullup_resistor: 2200 #4700
min_temp:0
max_temp: 310
max_power: 0.75
min_extrude_temp: 175
pressure_advance: 0.020
pressure_advance_smooth_time: 0.020
pid_version: 1
pid_target: 230.00
pid_tolerance: 0.0050
control: pid_v
pid_kp: 13.370
pid_ki: 0.775
pid_kd: 57.663

#####################################################################
#	Verify heaters
#####################################################################

[verify_heater heater_bed]
max_error: 240
check_gain_time: 120
hysteresis: 5
heating_gain: 2

[verify_heater extruder]
max_error: 120
check_gain_time: 30
hysteresis: 5
heating_gain: 2

#####################################################################
#	Printer and board pins
#####################################################################

[printer]
kinematics: cartesian
max_velocity: 900
max_accel: 25000
max_z_velocity: 4.5
max_z_accel: 500   #1000

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PC5

#####################################################################
#	ADXL345
#####################################################################

[resonance_tester]
accel_chip: beacon
accel_per_hz: 100  # default is 75
probe_points: 150,200,20

#####################################################################
#	Input shaper
#####################################################################

[input_shaper]
shaper_type_y: smooth_zv
smoother_freq_y: 27.0
shaper_type_x: smooth_ei
smoother_freq_x: 42.0
enabled_extruders: extruder

#####################################################################
#	Misc
#####################################################################

[gcode_button kill_switch]
pin: !PG15
press_gcode: 
    PAUSE
    M118 X or Y motion is blocked.
    M107
    M104 S0
#    echo FIRMWARE_RESTART > /tmp/printer
#    echo RESTART > /tmp/printer

#####################################################################
#	5V LED
#####################################################################

[led LED]
white_pin: PD14
cycle_time: 0.010
hardware_pwm: False
initial_WHITE: 0.15

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [skew_correction calilantern_skew_profile]
#*# xy_skew = 0.00030405691003412155
#*# xz_skew = -0.0004666936565293689
#*# yz_skew = 0.00020506132198342048
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 70.0
#*# pid_ki = 0.7
#*# pid_kd = 1169.0
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.046061, 0.024646, 0.025571, 0.012031, 0.022549, 0.014722, 0.026489, 0.033099, 0.047502, 0.041950, 0.060291, 0.052898, 0.066135, 0.047092, 0.067646, 0.054026, 0.056832, 0.043084, 0.052128, 0.045106
#*# 	  0.041229, 0.035142, 0.028652, 0.022602, 0.020881, 0.014597, 0.024347, 0.038367, 0.038604, 0.040238, 0.053967, 0.051835, 0.053877, 0.049181, 0.058767, 0.048740, 0.046640, 0.038588, 0.045878, 0.021155
#*# 	  0.036010, 0.032075, 0.026008, 0.019679, 0.012523, 0.005996, 0.010292, 0.034703, 0.031542, 0.032637, 0.031966, 0.035816, 0.036590, 0.035787, 0.036174, 0.035999, 0.025618, 0.014839, 0.021135, 0.000079
#*# 	  0.024376, 0.021180, 0.014235, 0.010635, 0.003921, 0.007703, 0.011036, 0.025909, 0.021295, 0.020221, 0.022823, 0.019059, 0.020106, 0.013719, 0.014880, 0.011168, 0.001871, -0.011059, -0.006619, -0.022733
#*# 	  0.024401, 0.018919, 0.015940, 0.000406, -0.002700, 0.000899, 0.004623, 0.020072, 0.011807, 0.006420, 0.009054, 0.004683, 0.005542, -0.003886, -0.001498, -0.006581, -0.014528, -0.030319, -0.026818, -0.045448
#*# 	  0.018462, -0.000281, -0.002049, -0.014997, -0.010640, -0.009432, -0.006447, 0.002483, 0.001861, -0.005635, -0.003447, -0.009342, -0.007208, -0.017033, -0.014387, -0.022101, -0.030845, -0.048842, -0.045337, -0.064526
#*# 	  0.011563, 0.004113, -0.012236, -0.020314, -0.024796, -0.024639, -0.018641, -0.016118, -0.014337, -0.019954, -0.019483, -0.025989, -0.019175, -0.031396, -0.030533, -0.037175, -0.044488, -0.062475, -0.061699, -0.080106
#*# 	  0.006790, -0.003897, -0.003117, -0.003990, -0.018178, -0.025351, -0.029436, -0.021569, -0.023996, -0.028353, -0.027585, -0.033375, -0.027993, -0.037379, -0.038743, -0.042760, -0.054581, -0.069391, -0.074930, -0.091359
#*# 	  0.005055, -0.000535, -0.017549, -0.034687, -0.027199, -0.027230, -0.031706, -0.024325, -0.028156, -0.027761, -0.031495, -0.032574, -0.032643, -0.039129, -0.040961, -0.046500, -0.059806, -0.075778, -0.083379, -0.099380
#*# 	  0.006649, -0.015166, -0.033445, -0.043820, -0.041405, -0.038895, -0.035970, -0.030353, -0.032062, -0.032016, -0.037585, -0.038162, -0.036147, -0.043959, -0.045038, -0.051515, -0.068663, -0.080455, -0.092625, -0.108508
#*# 	  -0.024883, -0.028426, -0.039891, -0.042001, -0.046331, -0.045090, -0.047813, -0.037430, -0.041525, -0.041137, -0.042999, -0.037925, -0.042057, -0.047868, -0.051472, -0.053467, -0.074079, -0.081274, -0.096526, -0.110672
#*# 	  -0.021703, -0.022548, -0.033199, -0.039102, -0.044281, -0.038419, -0.043088, -0.033287, -0.036580, -0.032659, -0.039349, -0.034254, -0.037558, -0.042131, -0.049740, -0.050553, -0.070184, -0.079554, -0.095450, -0.107185
#*# 	  -0.018015, -0.017361, -0.026491, -0.032306, -0.035417, -0.033189, -0.034035, -0.023167, -0.027291, -0.026597, -0.029926, -0.025868, -0.030275, -0.037917, -0.042411, -0.045220, -0.063144, -0.072831, -0.086975, -0.100498
#*# 	  -0.015051, -0.012522, -0.023441, -0.033854, -0.034261, -0.028482, -0.026279, -0.017657, -0.020294, -0.016825, -0.014945, -0.006394, -0.017014, -0.024702, -0.029893, -0.032668, -0.049319, -0.060160, -0.072833, -0.089757
#*# 	  -0.005573, -0.010803, -0.020561, -0.024873, -0.027156, -0.019950, -0.017713, -0.001796, -0.005729, 0.000653, 0.002570, 0.016231, 0.005515, -0.006320, -0.015989, -0.015715, -0.034767, -0.041248, -0.057129, -0.073991
#*# 	  -0.004633, -0.012165, -0.016024, -0.018496, -0.019859, -0.014424, -0.008099, 0.008829, 0.012021, 0.019046, 0.011499, 0.016933, 0.015042, 0.010456, 0.007471, 0.012986, -0.010157, -0.024654, -0.039288, -0.052798
#*# 	  0.000769, -0.000968, -0.009642, -0.009227, -0.009789, 0.003237, 0.006419, 0.022560, 0.029653, 0.039902, 0.032578, 0.039399, 0.034145, 0.031812, 0.025692, 0.024714, 0.001861, -0.005471, -0.019257, -0.032013
#*# 	  0.015041, 0.011199, 0.014843, 0.027699, 0.016570, 0.022335, 0.024506, 0.051926, 0.053415, 0.062813, 0.055415, 0.064593, 0.056579, 0.058877, 0.049429, 0.049293, 0.027475, 0.020552, 0.005443, -0.010432
#*# 	  0.025264, 0.026752, 0.022939, 0.034484, 0.035936, 0.044358, 0.048863, 0.075054, 0.071833, 0.078082, 0.077378, 0.081851, 0.082919, 0.076346, 0.073945, 0.063743, 0.053359, 0.044685, 0.035867, 0.015201
#*# 	  0.050031, 0.049204, 0.061848, 0.059782, 0.065256, 0.073661, 0.089320, 0.100676, 0.109050, 0.106568, 0.118294, 0.114071, 0.129067, 0.114722, 0.118107, 0.103915, 0.102186, 0.087805, 0.087078, 0.063454
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 0.0
#*# max_x = 283.0
#*# min_y = -20.0
#*# max_y = 340.0
#*#
#*# [telemetry]
#*# enabled = False
#*#
#*# [beacon model default]
#*# model_coef = 1.6506963817211722,
#*# 	2.0123821809327938,
#*# 	0.7740403576462671,
#*# 	0.34485432272166044,
#*# 	0.11248951132983132,
#*# 	-0.22308930317875236,
#*# 	0.0252528130862487,
#*# 	0.4375398959686364,
#*# 	0.03907337558093772,
#*# 	-0.16858486403024583
#*# model_domain = 1.8899515260306462e-07,1.9397366025782743e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 48.550244
#*# model_offset = 0.18000
